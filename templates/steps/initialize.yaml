parameters:
  - name: additionalRepositories
    type: object
    default: []
  - name: tokenReplaceLocations
    type: string
    default: ''
  - name: tokenReplaceEscapeConfig
    type: string
    default: ''

steps:
  - checkout: self
    path: s/self

  - checkout: PipelineCommon
    path: s/PipelineCommonFiles
  
  - ${{ each additionalRepo in parameters.additionalRepositories }}:
    - checkout: ${{ additionalRepo }}
      path: s/${{ additionalRepo }}

  - template: /templates/steps/replace-tokens.yaml
    parameters:
      rootDirectorylocation: '$(Build.SourcesDirectory)'
      targetFileslocation: |
        s/self/**/*.parameters.json => *.transformed.parameters.json
        s/self/**/*.bicepparam => *.transformed.bicepparam
        ${{ parameters.tokenReplaceLocations }}
      escapeType: ${{ parameters.tokenReplaceEscapeConfig }}