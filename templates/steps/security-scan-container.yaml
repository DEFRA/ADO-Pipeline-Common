parameters:
  - name: snykConnection
    type: string       
  - name: acrRepoName
    type: string   
  - name: acrRepoTagVersion
    type: string
  - name: snykOrganizationName
    type: string
    default: 'defra'
  - name: failOnThreshold
    type: string
    default: 'high'
  - name: dockerfilePath
    type: string
    default: './Dockerfile'
steps:   
- task: SnykSecurityScan@1
  displayName: 'Snyk containter scan'
  inputs:
    serviceConnectionEndpoint: ${{ parameters.snykConnection }} 
    testType: 'container'
    dockerImageName:  ${{ parameters.acrRepoName }}:${{ parameters.acrRepoTagVersion }}
    dockerfilePath: '${{ parameters.dockerfilePath }}'
    monitorOnBuild: false
    failOnIssues: true
    projectName: '${{ parameters.acrRepoName }}'
    organization: '${{ parameters.snykOrganizationName }}'    
    failOnThreshold: '${{ parameters.failOnThreshold }}'
  enabled: true
  continueOnError: ${{ ne(variables['Build.Reason'], 'PullRequest') }}
    
