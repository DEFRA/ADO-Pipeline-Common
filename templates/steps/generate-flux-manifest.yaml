parameters:
- name: ApiBaseUri
  type: string
- name: TeamName
  type: string
- name: ServiceName
  type: string
- name: EnvName
  type: string
- name: KeyVaultName
  type: string
- name: TenantId
  type: string  
steps:
  - task: PowerShell@2
    displayName: 'Generate Flux Manifest' 
    name: GenerateFluxManifest   
    inputs:
      targetType: filePath
      filePath: '$(Pipeline.Workspace)/s/ADO-Pipeline-Common/templates/powershell/build/GenerateFluxManifest.ps1'
      arguments: >
        -ApiBaseUri "${{ parameters.ApiBaseUri }}"
        -TeamName "${{ parameters.TeamName }}"
        -ServiceName "${{ parameters.ServiceName }}"
        -EnvName "${{ parameters.EnvName }}"
        -KeyVaultName "${{ parameters.KeyVaultName }}"
        -TenantId "${{ parameters.TenantId }}""
      failOnStderr: false      
      pwsh: true
      workingDirectory: '$(Pipeline.Workspace)/s'  