parameters:
- name: secretNames
  type: string  
- name: variableGroups
  type: string  
- name: serviceConnection
  type: string
- name: appKeyVault
  type: string    
- name: PSHelperDirectory
  type: string   

trigger:
- none

resources:
  repositories:
    - repository: PipelineCommon
      name: DEFRA/ADO-Pipeline-Common
      endpoint: DEFRA
      type: github
      ref: refs/heads/rv/323021

variables:
- ${{ each varGroup in split(parameters.variableGroups, ';') }}:
  - group: '${{ varGroup }}'

steps:  
  - checkout: PipelineCommon
    path: s/ADO-Pipeline-Common
  - ${{ each secret in split(parameters.secretNames, ';') }} :
    - template: ../steps/secrets-import-kv.yaml
      parameters:
        workingDirectory: '$(Pipeline.Workspace)/s'
        PSHelperDirectory: ${{ parameters.PSHelperDirectory }}
        secretName: ${{ secret }}
        serviceConnection: ${{ parameters.ServiceConnection }}
        appKeyVault: ${{ parameters.appKeyVault }}  